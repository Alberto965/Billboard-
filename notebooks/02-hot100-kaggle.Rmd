---
title: "Billboard Hot 100 from Kaggle"
output:
  html_document:
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs") })
---

## About this notebook

My current source of Billboard Hot 100 data on data.world is has not been updating, but there is another archive on [Kaggle](https://www.kaggle.com/dhruvildave/billboard-the-hot-100-songs) that I'm now exploring here.

As of 2022-01-08 the Kaggle data was missing the last several weeks of 2021. I've scrapped that data (See notebooks/01-hot100-dataminer for details) and we will append it here to make an archive complete through 2021.

> I will also consider scraping this myself as time moves forward. It would be nice to convert that to R instead of Data Miner.

Once the gap data is merged I muddy it up for lesson purposes. Evil, I know.

## Setup

```{r setup, echo=T, results='hide', message=F, warning=F}
library(tidyverse)
library(janitor)
library(lubridate)
```

## Import

I'd like to find a way to import directly from Kaggle but have not explored that yet. As such files have been manually downloaded.

> Perhaps this [kaggler](https://github.com/mkearney/kaggler) package can help if I explore it. I haven't yet.

```{r import}
hot100_k_raw <- read_csv("../data-download/hot100_kaggle_195808_20211106.csv") %>% 
  clean_names()

hot100_k_raw %>% glimpse()
```


Descriptions of the columns:

| column_name    | datatype | column_desc                          |
|----------------|----------|--------------------------------------|
| date           | date     | Date of chart                        |
| rank           | int      | Rank of song                         |
| song           | str      | Song title                           |
| artist         | str      | Song artist                          |
| last_week      | int      | Rank in previous week                |
| peak_rank      | int      | Top rank achieved by the song        |
| weeks_on_board | int      | Weeks the song appeared on the chart |


The data is very clean ... not much to do here. It has all the things we use in class. In fact, it may be too clean as we don't have to convert dates or anything.

## Update with gap data

This imports the game data

```{r import-gap}
gap <- read_rds("../data-process/hot-100/hot100_kaggle_gap2021.rds")
```

```{r bind}
hot100_k <- hot100_k_raw %>% 
  bind_rows(gap)

hot100_k %>% glimpse()
```

## Muck up data for learning purposes

```{r muck}
hot100_muck <- hot100_k %>% 
  # muck a date
  mutate(
    yr = year(date) %>% as.character(),
    mo = month(date) %>% as.character(),
    dy = day(date) %>% as.character(),
    chart_week = paste(mo, dy, yr, sep = "-")
  ) %>% 
  # muck the names
  select(
    `CHART WEEK` = chart_week,
    `THIS WEEK` = rank,
    `SONG` = song,
    `PERFORMER` = artist,
    `LAST WEEK` = last_week,
    `PEAK POS.` = peak_rank,
    `WKS ON CHART` = weeks_on_board
  )

hot100_muck %>% glimpse()
```


## Export

Here we print out the nice Kaggle data to `data-process` folder, and then verisons to the `data-out` folder for consuming into lessons later.

```{r export}
hot100_k %>% write_rds("../data-process/hot-100/hot100_kaggle_1958_2021.rds")
hot100_muck %>% write_csv("../data-out/hot100_archive_1958_2021.csv")
hot100_muck %>% write_csv("../data-out/hot100_archive.csv")
```

## Test archive

Since I'm mucking up the data on purpose, I'd like to make sure it _worked_.

```{r}
archive <- read_csv("../data-out/hot100_archive.csv")
```


